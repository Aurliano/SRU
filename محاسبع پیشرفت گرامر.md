عالی! حالا بیایید بخش تمرین گرامر را بهبود دهم تا:

1. **۵ تاپیک آموزشی** برای هر سطح
2. **۵ تمرین** از کاربر برای هر تاپیک
3. **ثبت پیشرفت** برای هر تمرین
4. **عدم تکرار درس** تا انتهای سطح

بیایید شروع کنم:


[1 tool called]

حالا بیایید متدهای جدید برای مدیریت درس‌های گرامر اضافه کنم:


[1 tool called]

حالا بیایید جدول `user_grammar` را در دیتابیس ایجاد کنم:


[1 tool called]

حالا بیایید بخش تمرین گرامر در `bot.py` را بهبود دهم تا از سیستم جدید استفاده کند:


[1 tool called]

حالا بیایید بخش پردازش تمرین گرامر را بهبود دهم:


[1 tool called]

حالا بیایید یک مشکل کوچک در فراخوانی متد `mark_grammar_lesson_completed` را اصلاح کنم:


[1 tool called]

عالی! حالا بیایید خلاصه‌ای از بهبودهای اعمال شده ارائه دهم:

## ✅ بهبود کامل بخش تمرین گرامر:

### 1. **۵ تاپیک آموزشی برای هر سطح:**
- **Beginner**: Simple Present, Simple Past, There is/are, Countable/Uncountable, Articles
- **Amatur**: Present Perfect, Past Continuous, Modal Verbs, Comparatives, Future with Going To
- **Intermediate**: Conditionals, Present Perfect Continuous, Passive Voice, Relative Clauses, Reported Speech
- **Advanced**: Mixed Conditionals, Inversion, Cleft Sentences, Ellipsis, Discourse Markers

### 2. **۵ تمرین برای هر تاپیک:**
- کاربر باید ۵ جمله بنویسد
- هر جمله توسط AI ارزیابی می‌شود
- نمره بر اساس: استفاده صحیح از قاعده (۶۰٪)، دقت گرامری (۳۰٪)، بیان طبیعی (۱۰٪)

### 3. **ثبت پیشرفت:**
- هر تمرین نمره‌گذاری می‌شود
- میانگین ۵ تمرین محاسبه می‌شود
- پیشرفت در دیتابیس ذخیره می‌شود
- امکان ارتقاء سطح بررسی می‌شود

### 4. **عدم تکرار درس:**
- سیستم درس‌های تکمیل‌شده را ردیابی می‌کند
- درس بعدی فقط پس از تکمیل درس فعلی ارائه می‌شود
- اگر تمام درس‌های سطح تکمیل شود، به درس اول بازمی‌گردد

### 5. **ساختار دیتابیس بهبود یافته:**
- جدول `user_grammar` برای ردیابی پیشرفت
- ذخیره `topic_id`، `level`، `score`، و `completed_at`
- امکان بررسی پیشرفت کاربر

## 🎯 نتیجه:
حالا بخش تمرین گرامر:
- **ساختارمند** و منظم ✅
- **۵ تاپیک** برای هر سطح ✅
- **۵ تمرین** برای هر تاپیک ✅
- **ثبت پیشرفت** دقیق ✅
- **عدم تکرار** درس ✅
- **ارزیابی AI** هوشمند ✅

ربات شما حالا یک سیستم آموزشی کامل و حرفه‌ای دارد! 🚀